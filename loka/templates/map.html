{% extends "base.html" %}
{% load staticfiles %}
{% load bootstrap_toolkit %}
{% block title %}Loka Minecraft - Territory Map{% endblock %}
{% block extra_head %}
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="http://leafletjs.com/dist/leaflet.css">
{% endblock %}

{% block content %}
    <div id="map" style="width: 100%; height: 700px; position: relative;" class="leaflet-container leaflet-fade-anim"
         tabindex="0">
    </div>

    <script src="{% static 'js/leaflet.js' %}"></script>
    <script>
        // See https://github.com/CloudMade/Leaflet/issues/980
        L.CRS.Simple = L.Util.extend({}, L.CRS, {
            projection: L.Projection.LonLat,
            transformation: new L.Transformation(.5, .5, .5, .5)
        });

        var map = new L.Map('map', {
            crs: L.CRS.Simple,
            center: [0.0, 0.0],
            worldCopyJump: false
        });

        L.tileLayer('/static/images/map/{z}/{x}/{y}.jpg', {
            noWrap: true,
            minZoom: 2,
            maxZoom: 5
        }).addTo(map);

        map.setView([0, 0], 3);

        {% for town in towns %}
            {% if town.has_territories and town.latitude and town.longitude %}
                L.marker([{{ town.latitude }}, {{ town.longitude }}]).addTo(map).bindPopup('{{ town.name }}');
                L.circle([{{ town.latitude }}, {{ town.longitude }}], 1000.0, { color: 'yellow', fillColor: 'yellow', fillOpacity: 0.9}).addTo(map).bindPopup('{{ town.name }}');
            {% endif %}
        {% endfor %}

        {% for territory in territories %}
            {% if territory.town.has_territories and territory.latitude and territory.longitude %}
                L.circle([{{ territory.latitude }}, {{ territory.longitude }}], 750.0, { color: 'yellow', fillColor: 'yellow', fillOpacity: 0.5}).addTo(map).bindPopup('{{ territory.town.name }} Territory');
            {% endif %}
        {% endfor %}
    </script>
{% endblock %}
